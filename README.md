# TelegramModule plugin for openITCOCKPIT 4

## Installation

### Latest version from GitHub
- Clone the module contents into /opt/openitc/frontend/plugins/TelegramModule
- Run `composer install` in /opt/openitc/frontend/plugins/TelegramModule
- Edit `/opt/openitc/frontend/src/Lib/PluginManager.php`
- Run `openitcockpit-update`

#### Commands step by step:
```bash
cd /opt/openitc/frontend/plugins
git clone https://github.com/binsky08/openITCOCKPIT-Telegram-Module TelegramModule
cd TelegramModule
composer install
```

Edit `/opt/openitc/frontend/src/Lib/PluginManager.php`

Add this code snippet at line 91:
```php
if (is_file(PLUGIN . $moduleName . DS . 'vendor/autoload.php')) {
    require PLUGIN . $moduleName . DS . 'vendor/autoload.php';
}
```

After it the file should look like this
![oitc-tg-pm-snippet](https://user-images.githubusercontent.com/30630233/105217488-35a02400-5b54-11eb-8d4c-74ef18505c7a.png)

Run `openitcockpit-update`


## Configuration

### Basic configuration

- Open [BotFather](https://t.me/botfather) in telegram
- Run `/newbot`
    - define e.g. openITCOCKPIT as name
    - define e.g. oitcTGBot as username

Your new bot is now located at [t.me/oitcTGBot](https://t.me/oitcTGBot)

- Copy the HTTP API token which was generated by the BotFather.

**Keep your token secure and store it safely, it can be used by anyone to control your bot!**

- Open the openITCOCKPIT Telegram configuration, enter the copied bot token and save the configuration.

- Add the 'host-notify-by-telegram' and 'service-notify-by-telegram' commands to your notification contact.

### Extended configuration (recommended)

To enable real-time interactions from the bot with openITCOCKIT, setup the two-way webhook integration.

- Open the openITCOCKPIT Telegram configuration and check the optional field "Enable two-way webhook integration".

- Make sure the configured "External webhook domain" is correct and openITCOCKPIT is reachable from the Internet using this domain.

- Create a new openITCOCKPIT API Key for your user and insert it into the "Webhook api key" field.

- Save the changes and try it out.

openITCOCKPIT automatically set up the webhook for the bot with the given token. This connection can be removed by saving with an unchecked "Enable two-way webhook integration" field.

## Usage

Notifications sent by the openITCOCKPIT telegram module can be received by any chat with a real telegram user or by channels.

With enabled two-way integration issues can be acknowledged by simply clicking the button for an action provided by the bot message.

If your openITCOCKPIT is reachable from the Internet and you configured the two-way webhook integration, interactions with the bot are processed within seconds.

If your openITCOCKPIT is not reachable from the Internet, the built-in basic two-way integration calls up interactions cached by Telegram and processes them every minute. (Therefore, interactions with the bot can take up to a minute to process!)

Run `/help` in bot chat to get more information about how to control the bot.
